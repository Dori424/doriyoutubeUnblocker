<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YouTube Unblocker PRO + Auth</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0d0d0d;
      color: white;
      margin: 0;
    }

    .center {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    h1 {
      font-size: 32px;
      margin-bottom: 20px;
      color: #ff4c4c;
      text-align: center;
    }

    .box {
      background: #1a1a1a;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(255,0,0,0.3);
      width: 90%;
      max-width: 400px;
      text-align: center;
    }

    input, button {
      width: 90%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 6px;
      border: none;
      outline: none;
      font-size: 17px;
    }

    button {
      background: #e62117;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s ease-in-out;
    }

    button:hover {
      background: #c91512;
    }

    iframe {
      margin-top: 25px;
      width: 90vw;
      max-width: 900px;
      height: calc(90vw * 0.5625);
      max-height: 510px;
      border: none;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.4);
    }
  </style>
</head>
<body>

<div id="loginScreen" class="center">
  <div class="box">
    <h2>Login</h2>
    <input id="loginUser" type="text" placeholder="Username" />
    <input id="loginPass" type="password" placeholder="Password" />
    <button onclick="login()">Login</button>
  </div>
</div>

<div id="adminPanel" class="center" style="display:none;">
  <div class="box">
    <h2>Admin Panel</h2>
    <input id="newUser" type="text" placeholder="New Username" />
    <input id="newPass" type="text" placeholder="New Password" />
    <button onclick="addUser()">Add User</button>

    <input id="delUser" type="text" placeholder="Delete Username" />
    <button onclick="removeUser()">Remove User</button>

    <input id="blockDev" type="text" placeholder="Device ID" />
    <button onclick="blockDevice()">Block Device</button>

    <button style="margin-top:15px; background:#444;" onclick="enterApp()">Enter App</button>
  </div>
</div>

<div id="appScreen" style="display:none;" class="center">
  <h1>YouTube Unblocker PRO</h1>

  <div class="input-box">
    <input id="ytLink" type="text" placeholder="Enter YouTube link (any format)" />
    <button onclick="loadVideo()">Load</button>
  </div>

  <div id="videoContainer"></div>
  <div id="recommended" style="margin-top:30px; max-width:900px; width:90vw; text-align:center;"></div>
</div>

<script>
  const deviceId = localStorage.getItem("deviceId") || crypto.randomUUID();
  localStorage.setItem("deviceId", deviceId);

  async function api(data) {
    const res = await fetch("/api/auth", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ...data, deviceId })
    });
    return res.json();
  }

  async function login() {
    const username = loginUser.value;
    const password = loginPass.value;

    const r = await api({ action: "login", username, password });

    if (r.error) return alert(r.error);

    if (r.admin) adminPanel.style.display = "flex";
    else appScreen.style.display = "flex";

    loginScreen.style.display = "none";
  }

  async function addUser() {
    const r = await api({
      action: "addUser",
      username: loginUser.value,
      password: loginPass.value,
      newUser: newUser.value,
      newPass: newPass.value
    });
    alert(r.error || "User added");
  }

  async function removeUser() {
    const r = await api({
      action: "removeUser",
      username: loginUser.value,
      password: loginPass.value,
      targetUser: delUser.value
    });
    alert(r.error || "User removed");
  }

  async function blockDevice() {
    const r = await api({
      action: "blockDevice",
      username: loginUser.value,
      password: loginPass.value,
      deviceId: blockDev.value
    });
    alert(r.error || "Device blocked");
  }

  function enterApp() {
    adminPanel.style.display = "none";
    appScreen.style.display = "flex";
  }

  function extractVideoId(url) {
    const patterns = [ /v=([^&]+)/, /youtu\.be\/([^?]+)/, /embed\/([^?]+)/, /shorts\/([^?]+)/ ];
    for (const p of patterns) {
      const m = url.match(p);
      if (m) return m[1];
    }
    return null;
  }

  function loadVideo() {
    const url = ytLink.value.trim();
    const id = extractVideoId(url);
    if (!id) return alert("Invalid YouTube link");

    videoContainer.innerHTML = `<iframe src="https://www.youtube.com/embed/${id}" allowfullscreen></iframe>`;
    recommended.innerHTML = `<h2>Recommended</h2><iframe style='height:300px;' src='https://www.youtube.com/embed/videoseries?list=RD${id}' allowfullscreen></iframe>`;
  }
</script>
</body>
</html>
